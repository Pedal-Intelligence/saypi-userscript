// ==UserScript==
// @name         Say, Pi
// @namespace    http://www.saypi.ai/
// @version      1.2.4
// @description  Speak to Pi with OpenAI's Whisper
// @author       Ross Cadogan
// @match        https://pi.ai/talk
// @inject-into  page
// @updateURL    https://app.saypi.ai/saypi.user.js
// @downloadURL  https://app.saypi.ai/saypi.user.js
// @license      MIT
// ==/UserScript==

/******/ (() => { // webpackBootstrap
/******/ 	var __webpack_modules__ = ({

/***/ "./node_modules/raw-loader/dist/cjs.js!./src/transcriber.js":
/*!******************************************************************!*\
  !*** ./node_modules/raw-loader/dist/cjs.js!./src/transcriber.js ***!
  \******************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ("// audio output (Pi)\nvar audioElement = document.querySelector('audio');\nif (!audioElement) {\n  console.error(\"Audio element not found!\");\n}\nfunction isSafari() {\n  return /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\n}\naudioElement.preload = \"auto\"; // enable aggressive preloading of audio\nvar piAudioManager = {\n  isSpeaking: false,\n  audioElement: audioElement,\n  _userStarted: true,\n  // flag to indicate playback has been started by the user (true by default because user must request initial playback)\n  _isLoadCalled: false,\n  // flag to indicate if the load() method has been called on the audio element\n\n  userPlay: function userPlay() {\n    if (!isSafari()) {\n      return;\n    }\n    this._userStarted = true; // set a flag to indicate playback has been started by the user\n    this.audioElement.load(); // reset for Safari\n    this.audioElement.play();\n    console.log('User started playback');\n  },\n  autoPlay: function autoPlay() {\n    if (!isSafari()) {\n      return;\n    }\n    if (!this._userStarted) {\n      this.audioElement.pause();\n      console.log('Autoplay prevented');\n    }\n  },\n  stop: function stop() {\n    if (this.isSpeaking) {\n      this.audioElement.pause();\n    }\n    if (this.audioElement.duration && !this.audioElement.ended && this.audioElement.currentTime < this.audioElement.duration) {\n      this.audioElement.currentTime = this.audioElement.duration; // seek the audio to the end\n      this.audioElement.play(); // trigger the ended event\n    }\n  },\n\n  pause: function pause() {\n    this.audioElement.pause();\n  },\n  resume: function resume() {\n    this.audioElement.play();\n  },\n  loading: function loading() {\n    if (!isSafari()) {\n      return;\n    }\n    if (!this._isLoadCalled) {\n      this._isLoadCalled = true; // Set the flag to true\n      this.showPlayButton(); // Show the play button\n    } else {\n      this._isLoadCalled = false; // Reset the flag\n    }\n  },\n\n  playing: function playing() {\n    this.isSpeaking = true;\n    if (isSafari()) {\n      this.hidePlayButton();\n    }\n  },\n  stopped: function stopped() {\n    this.isSpeaking = false;\n    this._userStarted = false;\n  },\n  showPlayButton: function showPlayButton() {\n    var playButton = document.getElementById('saypi-playAudio');\n    if (!playButton) {\n      playButton = this.createPlayButton();\n    }\n    playButton.style.display = 'block';\n  },\n  hidePlayButton: function hidePlayButton() {\n    var playButton = document.getElementById('saypi-playAudio');\n    if (playButton) {\n      playButton.style.display = 'none';\n    }\n  },\n  createPlayButton: function createPlayButton() {\n    var _this = this;\n    var playButton = document.createElement('button');\n    playButton.id = 'saypi-playAudio';\n    playButton.innerText = 'Hear Pi\\'s Response';\n    playButton.style.position = 'fixed';\n    playButton.style.top = '50%';\n    playButton.style.left = '50%';\n    playButton.style.transform = 'translate(-50%, 50%)';\n    playButton.style.padding = '10px 20px';\n    playButton.style.fontSize = '24px';\n    playButton.style.borderRadius = '5px';\n    playButton.style.border = 'none';\n    playButton.style.backgroundColor = 'rgb(228 216 193)';\n    playButton.style.zIndex = '9999'; // ensure it's on top of other elements\n    playButton.style.display = 'none'; // initially hidden\n    document.body.appendChild(playButton);\n\n    // Event listener to start playback\n    playButton.addEventListener('click', function () {\n      _this.userPlay();\n      _this.hidePlayButton();\n    });\n    return playButton;\n  }\n};\n\n// Intercept Autoplay Events (autoplay doesn't work on Safari)\naudioElement.addEventListener('play', function () {\n  piAudioManager.autoPlay();\n});\naudioElement.addEventListener('loadstart', function () {\n  piAudioManager.loading();\n});\n\n// Event listeners for detecting when Pi is speaking\naudioElement.addEventListener('playing', function () {\n  console.log('Pi is speaking');\n  piAudioManager.playing();\n});\naudioElement.addEventListener('pause', function () {\n  console.log('Pi stopped speaking');\n  piAudioManager.stopped();\n});\naudioElement.addEventListener('ended', function () {\n  console.log('Pi finished speaking');\n  piAudioManager.stopped();\n});\n\n// audio input (user)\nvar audioDataChunks = [];\nvar audioMimeType = 'audio/webm;codecs=opus';\nfunction uploadAudio(audioBlob) {\n  // Create a FormData object\n  var formData = new FormData();\n  var audioFilename = 'audio.webm';\n  if (audioBlob.type === 'audio/mp4') {\n    audioFilename = 'audio.mp4';\n  }\n  // Add the audio blob to the FormData object\n  formData.append('audio', audioBlob, audioFilename);\n  // Get the user's preferred language\n  var language = navigator.language;\n  // Post the audio to the server for transcription\n  fetch(config.apiServerUrl + '/transcribe?language=' + language, {\n    method: 'POST',\n    body: formData\n  }).then(function (response) {\n    if (!response.ok) {\n      throw Error(response.statusText);\n    }\n    return response.json();\n  }).then(handleTranscriptionResponse)[\"catch\"](function (error) {\n    console.error('Looks like there was a problem: ', error);\n    var textarea = document.getElementById('prompt');\n    textarea.value = 'Sorry, there was a problem transcribing your audio. Please try again later.';\n  });\n}\nfunction handleTranscriptionResponse(responseJson) {\n  var textarea = document.getElementById('prompt');\n  simulateTyping(textarea, responseJson.text + \" \");\n  console.log('Transcript: ' + responseJson.text);\n}\nfunction setNativeValue(element, value) {\n  var lastValue = element.value;\n  element.value = value;\n  var event = new Event(\"input\", {\n    target: element,\n    bubbles: true\n  });\n  // React 15\n  event.simulated = true;\n  // React 16-17\n  var tracker = element._valueTracker;\n  if (tracker) {\n    tracker.setValue(lastValue);\n  }\n  element.dispatchEvent(event);\n}\nfunction simulateFormSubmit(textarea) {\n  var enterEvent = new KeyboardEvent('keydown', {\n    bubbles: true,\n    key: 'Enter',\n    keyCode: 13,\n    which: 13\n  });\n  textarea.dispatchEvent(enterEvent);\n}\nfunction simulateTyping(element, text) {\n  var words = text.split(' '); // Split the text into words (may not be ideal for all languages)\n  var i = 0;\n  function typeWord() {\n    if (i < words.length) {\n      // Append the next word and a space, then increment i\n      setNativeValue(element, element.value + words[i++] + ' ');\n      // Call this function again before the next repaint\n      requestAnimationFrame(typeWord);\n    } else {\n      // Check if autosubmit is enabled\n      var talkButton = document.getElementById('talkButton');\n      if (talkButton.dataset.autosubmit === 'false') {\n        console.log('Autosubmit is disabled');\n      } else {\n        // Simulate an \"Enter\" keypress event\n        simulateFormSubmit(element);\n      }\n    }\n  }\n  // Start typing\n  typeWord();\n}\n\n// Declare a global variable for the mediaRecorder\nvar mediaRecorder;\nvar threshold = 1000; // 1000 ms = 1 second, about the length of \"Hey, Pi\"\n\n// This function will be called when the 'dataavailable' event fires\nfunction handleDataAvailable(e) {\n  // Add the audio data chunk to the array\n  audioDataChunks.push(e.data);\n}\n\n// This function will be called when the 'stop' event fires\nfunction handleStop() {\n  // Create a Blob from the audio data chunks\n  var audioBlob = new Blob(audioDataChunks, {\n    type: audioMimeType\n  });\n\n  // Get the stop time and calculate the duration\n  var stopTime = Date.now();\n  var duration = stopTime - window.startTime;\n\n  // If the duration is greater than the threshold, upload the audio for transcription\n  if (duration >= threshold) {\n    // download the audio\n    var url = URL.createObjectURL(audioBlob);\n    var a = document.createElement('a');\n    a.style.display = 'none';\n    a.href = url;\n    a.download = 'safari_audio.mp4';\n    document.body.appendChild(a);\n    // a.click();\n    // Upload the audio to the server for transcription\n    uploadAudio(audioBlob);\n  }\n\n  // Clear the array for the next recording\n  audioDataChunks = [];\n}\nfunction setupRecording(callback) {\n  if (mediaRecorder) {\n    return;\n  }\n\n  // Get a stream from the user's microphone\n  navigator.mediaDevices.getUserMedia({\n    audio: true\n  }).then(function (stream) {\n    if (!MediaRecorder.isTypeSupported(audioMimeType)) {\n      // use MP4 for Safari\n      audioMimeType = 'audio/mp4';\n    }\n    // Create a new MediaRecorder object using the stream and specifying the MIME type\n    var options = {\n      mimeType: audioMimeType\n    };\n    mediaRecorder = new MediaRecorder(stream, options);\n\n    // Listen for the 'dataavailable' event\n    mediaRecorder.addEventListener('dataavailable', handleDataAvailable);\n\n    // Listen for the 'stop' event\n    mediaRecorder.addEventListener('stop', handleStop);\n  }).then(function () {\n    // Invoke the callback function\n    if (typeof callback === 'function') {\n      callback();\n    }\n  })[\"catch\"](function (err) {\n    console.error('Error getting audio stream: ' + err);\n  });\n}\nfunction tearDownRecording() {\n  // Check if the MediaRecorder is set up\n  if (!mediaRecorder) {\n    return;\n  }\n\n  // Stop any ongoing recording\n  if (mediaRecorder.state === 'recording') {\n    mediaRecorder.stop();\n  }\n\n  // Remove the MediaRecorder's event listeners\n  mediaRecorder.removeEventListener('dataavailable', handleDataAvailable);\n  mediaRecorder.removeEventListener('stop', handleStop);\n\n  // Clear the MediaRecorder variable\n  mediaRecorder = null;\n}\n\n// This function will be called when the user presses the record button\nfunction startRecording() {\n  // Check if the MediaRecorder is set up\n  if (!mediaRecorder) {\n    setupRecording(startRecording);\n    return;\n  }\n  // Check if Pi is currently speaking and stop her audio\n  if (piAudioManager.isSpeaking) {\n    piAudioManager.pause();\n  }\n\n  // Start recording\n  mediaRecorder.start();\n\n  // Record the start time\n  window.startTime = Date.now();\n  console.log('User is speaking');\n\n  // This function will be called when the user releases the record button\n  window.stopRecording = function () {\n    if (mediaRecorder && mediaRecorder.state === 'recording') {\n      // Stop recording\n      mediaRecorder.stop();\n\n      // Record the stop time and calculate the duration\n      var stopTime = Date.now();\n      var duration = stopTime - window.startTime;\n\n      // If the duration is less than the threshold, don't upload the audio for transcription\n      if (duration < threshold) {\n        console.log('User stopped speaking');\n        console.log('Recording was too short, not uploading for transcription');\n        piAudioManager.resume();\n      } else {\n        console.log('User finished speaking');\n        piAudioManager.stop();\n      }\n    }\n    // Remove the stopRecording function\n    delete window.stopRecording;\n  };\n}\n\n// Add the startRecording function to the window object so it can be called from outside this script\nwindow.startRecording = startRecording;");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
var __webpack_exports__ = {};
// This entry need to be wrapped in an IIFE because it need to be isolated against other modules in the chunk.
(() => {
/*!****************************!*\
  !*** ./src/saypi.index.js ***!
  \****************************/
(function () {
  'use strict';

  var localConfig = {
    appServerUrl: "http://localhost:3000",
    apiServerUrl: "https://localhost:5000"
    // Add other configuration properties as needed
  };

  // Define a global configuration property
  var productionConfig = {
    appServerUrl: "https://app.saypi.ai",
    apiServerUrl: "https://api.saypi.ai"
    // Add other configuration properties as needed
  };

  var config = productionConfig;
  var pageScript = (__webpack_require__(/*! raw-loader!./transcriber.js */ "./node_modules/raw-loader/dist/cjs.js!./src/transcriber.js")["default"]);

  // Create a MutationObserver to listen for changes to the DOM
  var observer = new MutationObserver(function (mutations) {
    // Check each mutation
    for (var i = 0; i < mutations.length; i++) {
      var mutation = mutations[i];

      // If nodes were added, check each one
      if (mutation.addedNodes.length > 0) {
        for (var j = 0; j < mutation.addedNodes.length; j++) {
          var node = mutation.addedNodes[j];

          // If the node is the appropriate container element, add the button and stop observing
          if (node.nodeName.toLowerCase() === 'div' && node.classList.contains('fixed') && node.classList.contains('bottom-16')) {
            var footer = node;
            var buttonContainer = footer.querySelector('.relative.flex.flex-col');
            if (buttonContainer) {
              addTalkButton(buttonContainer);
            } else {
              console.log('No button container found in footer');
            }
            observer.disconnect();
            return;
          }
        }
      }
    }
  });
  function injectScript(callback) {
    var scriptElement = document.createElement("script");
    scriptElement.type = "text/javascript";
    scriptElement.id = 'saypi-script';
    var configText = 'var config = ' + JSON.stringify(config) + ';';
    scriptElement.textContent = configText + pageScript;
    document.body.appendChild(scriptElement);

    // Call the callback function after the script is added
    if (callback) {
      callback();
    }
  }
  function addTalkButton(container) {
    var button = document.createElement('button');
    button.id = 'talkButton';
    button.type = 'button';
    button.className = 'relative flex mt-1 mb-1 rounded-full px-2 py-3 text-center bg-cream-550 hover:bg-cream-650 hover:text-brand-green-700 text-muted';
    // Set ARIA label and tooltip
    var label = 'Talk (Hold Control + Space to use hotkey. Double click to toggle auto-submit on/off)';
    button.setAttribute('aria-label', label);
    button.setAttribute('title', label);
    // enable autosubmit by default
    button.dataset.autosubmit = 'true';
    button.classList.add('autoSubmit');
    container.appendChild(button);
    addTalkButtonStyles();
    addTalkIcon(button);

    // Call the function to inject the script after the button has been added
    injectScript(registerAudioButtonEvents);
  }
  function addTalkIcon(button) {
    var iconHtml = "\n        <svg xmlns=\"http://www.w3.org/2000/svg\" version=\"1.0\" viewBox=\"0 0 56.25 30\" class=\"waveform\">\n        <defs>\n            <clipPath id=\"a\">\n                <path d=\"M.54 12H3v5H.54Zm0 0\"/>\n            </clipPath>\n            <clipPath id=\"b\">\n                <path d=\"M25 2.2h2v24.68h-2Zm0 0\"/>\n            </clipPath>\n            <clipPath id=\"c\">\n                <path d=\"M53 12h1.98v5H53Zm0 0\"/>\n            </clipPath>\n        </defs>\n        <g clip-path=\"url(#a)\">\n            <path d=\"M1.48 12.71c-.5 0-.9.4-.9.9v1.85a.9.9 0 0 0 1.8 0v-1.84c0-.5-.4-.9-.9-.9Zm0 0\"/>\n        </g>\n        <path d=\"M4.98 6.63c-.5 0-.9.4-.9.9v14.01a.9.9 0 0 0 1.81 0v-14c0-.5-.4-.92-.9-.92Zm3.51 3.1a.9.9 0 0 0-.9.91v7.79a.9.9 0 0 0 1.8 0v-7.79c0-.5-.4-.9-.9-.9ZM12 3.83a.9.9 0 0 0-.91.9v19.6a.9.9 0 0 0 1.8 0V4.74c0-.5-.4-.9-.9-.9Zm3.5 8.29a.9.9 0 0 0-.91.9v3.03a.9.9 0 0 0 1.81 0v-3.03c0-.5-.4-.9-.9-.9ZM19 6.8c-.5 0-.9.4-.9.9v13.68a.9.9 0 0 0 1.8 0V7.7c0-.5-.4-.9-.9-.9Zm3.58-2.97h-.01c-.5 0-.9.4-.9.9l-.13 19.6c0 .5.4.9.9.91.5 0 .9-.4.9-.9l.14-19.6a.9.9 0 0 0-.9-.9Zm0 0\"/>\n        <g clip-path=\"url(#b)\">\n            <path d=\"M26 2.2c-.5 0-.9.4-.9.9v22.86a.9.9 0 1 0 1.81 0V3.11a.9.9 0 0 0-.9-.91Zm0 0\"/>\n        </g>\n        <path d=\"M29.52 7.71a.9.9 0 0 0-.91.9v11.85a.9.9 0 0 0 1.81 0V8.62c0-.5-.4-.9-.9-.9Zm3.5 2.93a.9.9 0 0 0-.9.91v5.97a.9.9 0 0 0 1.8 0v-5.97c0-.5-.4-.9-.9-.9Zm3.5-5.78c-.5 0-.9.4-.9.9v17.55a.9.9 0 0 0 1.81 0V5.76c0-.5-.4-.9-.9-.9Zm3.51 3.34c-.5 0-.9.4-.9.9v10.87a.9.9 0 0 0 1.8 0V9.1a.9.9 0 0 0-.9-.91Zm3.5 3.08c-.5 0-.9.4-.9.91v4.7a.9.9 0 1 0 1.8 0v-4.7a.9.9 0 0 0-.9-.9Zm3.51-7.45a.9.9 0 0 0-.91.9v19.6a.9.9 0 0 0 1.81 0V4.74c0-.5-.4-.9-.9-.9Zm3.5 5.57a.9.9 0 0 0-.9.91v8.45a.9.9 0 0 0 1.8 0v-8.45c0-.5-.4-.9-.9-.9Zm0 0\"/>\n        <g clip-path=\"url(#c)\">\n            <path d=\"M54.04 12.96a.9.9 0 0 0-.9.91v1.33a.9.9 0 1 0 1.8 0v-1.32a.9.9 0 0 0-.9-.92Zm0 0\"/>\n        </g>\n    </svg>\n    \n        ";
    var icon = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
    button.appendChild(icon);
    icon.outerHTML = iconHtml;
  }
  function addStyles(css) {
    var style = document.createElement('style');
    style.type = 'text/css';
    style.appendChild(document.createTextNode(css));
    document.head.appendChild(style);
  }
  function addTalkButtonStyles() {
    var isFirefoxAndroid = /Firefox/.test(navigator.userAgent) && /Android/.test(navigator.userAgent);
    if (isFirefoxAndroid) {
      // hack for Firefox on Android, which doesn't support :active correctly
      document.documentElement.classList.add('firefox-android');
    }

    // button animation
    addStyles("\n            @keyframes pulse {\n                0% {\n                    transform: scale(1);\n                }\n                50% {\n                    transform: scale(0.9);\n                }\n                100% {\n                    transform: scale(1);\n                }\n            }\n            #talkButton {\n                margin-top: 0.25rem;\n                border-radius: 18px;\n                width: 120px;\n                display: block; /* For Safari */\n            }\n\n            html:not(.firefox-android) #talkButton:active .waveform,\n            #talkButton.active .waveform {\n                animation: pulse 1s infinite;\n            }            \n            #talkButton .waveform {\n                fill: #776d6d;\n            }\n            #talkButton.autoSubmit .waveform {\n                fill: rgb(65 138 47); /* Pi's text-brand-green-600 */\n            }\n        ");
  }
  function registerAudioButtonEvents() {
    var button = document.getElementById('talkButton');
    var context = window;
    if (GM_info.scriptHandler !== 'Userscripts') {
      context = unsafeWindow;
    }

    // For desktop
    button.addEventListener('mousedown', function () {
      idPromptTextArea();
      context.startRecording();
    });
    button.addEventListener('mouseup', function () {
      var _context;
      if (typeof ((_context = context) === null || _context === void 0 ? void 0 : _context.stopRecording) === 'function') {
        context.stopRecording();
      }
    });
    registerHotkey();

    // "warm up" the microphone by acquiring it before the user presses the button
    document.getElementById('talkButton').addEventListener('mouseenter', setupRecording);
    document.getElementById('talkButton').addEventListener('mouseleave', tearDownRecording);
    window.addEventListener('beforeunload', tearDownRecording);

    // Attach a double click event listener to the talk button
    button.addEventListener('dblclick', function () {
      // Toggle the CSS classes to indicate the mode
      button.classList.toggle('autoSubmit');

      // Store the state on the button element using a custom data attribute
      if (button.getAttribute('data-autosubmit') === 'true') {
        button.setAttribute('data-autosubmit', 'false');
        console.log('autosubmit disabled');
      } else {
        button.setAttribute('data-autosubmit', 'true');
        console.log('autosubmit enabled');
      }
    });

    // For mobile
    button.addEventListener('touchstart', function (e) {
      e.preventDefault(); // Prevent the default click behavior from happening
      idPromptTextArea();
      context.startRecording();
      this.classList.add('active'); // Add the active class (for Firefox on Android)
    });

    button.addEventListener('touchend', function () {
      this.classList.remove('active'); // Remove the active class (for Firefox on Android
      context.stopRecording();
    });
    document.getElementById('talkButton').addEventListener('touchcancel', function () {
      this.classList.remove('active'); // Remove the active class (for Firefox on Android
      tearDownRecording();
    });
  }
  function registerHotkey() {
    // Register a hotkey for the button
    var ctrlDown = false;
    document.addEventListener('keydown', function (event) {
      if (event.ctrlKey && event.code === 'Space' && !ctrlDown) {
        ctrlDown = true;
        // Simulate mousedown event
        var mouseDownEvent = new Event('mousedown');
        document.getElementById('talkButton').dispatchEvent(mouseDownEvent);
        talkButton.classList.add('active'); // Add the active class
      }
    });

    document.addEventListener('keyup', function (event) {
      if (ctrlDown && event.code === 'Space') {
        ctrlDown = false;
        // Simulate mouseup event
        var mouseUpEvent = new Event('mouseup');
        document.getElementById('talkButton').dispatchEvent(mouseUpEvent);
        talkButton.classList.remove('active');
      }
    });
  }
  function idPromptTextArea() {
    var textarea = document.getElementById('prompt');
    if (!textarea) {
      // Find the first <textarea> element and give it an id
      var textareaElement = document.querySelector('textarea');
      if (textareaElement) {
        textareaElement.id = 'prompt';
      } else {
        console.log('No <textarea> element found');
      }
    }
  }

  // Start observing the entire document for changes to child nodes and subtree
  observer.observe(document, {
    childList: true,
    subtree: true
  });
})();
})();

/******/ })()
;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LFFBQVEsR0FBRyxLQUFLO1FBQ2hCO1FBQ0EsSUFBSVEsWUFBWSxHQUFHLElBQUlILEtBQUssQ0FBQyxTQUFTLENBQUM7UUFDdkMzRCxRQUFRLENBQUNtQyxjQUFjLENBQUMsWUFBWSxDQUFDLENBQUN5QixhQUFhLENBQUNFLFlBQVksQ0FBQztRQUNqRUQsVUFBVSxDQUFDekUsU0FBUyxDQUFDaUUsTUFBTSxDQUFDLFFBQVEsQ0FBQztNQUN6QztJQUNKLENBQUMsQ0FBQztFQUNOO0VBR0EsU0FBU1gsZ0JBQWdCQSxDQUFBLEVBQUc7SUFDeEIsSUFBSXFCLFFBQVEsR0FBRy9ELFFBQVEsQ0FBQ21DLGNBQWMsQ0FBQyxRQUFRLENBQUM7SUFDaEQsSUFBSSxDQUFDNEIsUUFBUSxFQUFFO01BQ1g7TUFDQSxJQUFJQyxlQUFlLEdBQUdoRSxRQUFRLENBQUNSLGFBQWEsQ0FBQyxVQUFVLENBQUM7TUFDeEQsSUFBSXdFLGVBQWUsRUFBRTtRQUNqQkEsZUFBZSxDQUFDN0QsRUFBRSxHQUFHLFFBQVE7TUFDakMsQ0FBQyxNQUFNO1FBQ0hULE9BQU8sQ0FBQ0MsR0FBRyxDQUFDLDZCQUE2QixDQUFDO01BQzlDO0lBQ0o7RUFDSjs7RUFFQTtFQUNBbEIsUUFBUSxDQUFDd0YsT0FBTyxDQUFDakUsUUFBUSxFQUFFO0lBQUVrRSxTQUFTLEVBQUUsSUFBSTtJQUFFQyxPQUFPLEVBQUU7RUFBSyxDQUFDLENBQUM7QUFDbEUsQ0FBQyxFQUFFLENBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zYXlwaS11c2Vyc2NyaXB0Ly4vc3JjL3RyYW5zY3JpYmVyLmpzIiwid2VicGFjazovL3NheXBpLXVzZXJzY3JpcHQvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vc2F5cGktdXNlcnNjcmlwdC93ZWJwYWNrL3J1bnRpbWUvZGVmaW5lIHByb3BlcnR5IGdldHRlcnMiLCJ3ZWJwYWNrOi8vc2F5cGktdXNlcnNjcmlwdC93ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kIiwid2VicGFjazovL3NheXBpLXVzZXJzY3JpcHQvd2VicGFjay9ydW50aW1lL21ha2UgbmFtZXNwYWNlIG9iamVjdCIsIndlYnBhY2s6Ly9zYXlwaS11c2Vyc2NyaXB0Ly4vc3JjL3NheXBpLmluZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBkZWZhdWx0IFwiLy8gYXVkaW8gb3V0cHV0IChQaSlcXG52YXIgYXVkaW9FbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYXVkaW8nKTtcXG5pZiAoIWF1ZGlvRWxlbWVudCkge1xcbiAgY29uc29sZS5lcnJvcihcXFwiQXVkaW8gZWxlbWVudCBub3QgZm91bmQhXFxcIik7XFxufVxcbmZ1bmN0aW9uIGlzU2FmYXJpKCkge1xcbiAgcmV0dXJuIC9eKCg/IWNocm9tZXxhbmRyb2lkKS4pKnNhZmFyaS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCk7XFxufVxcbmF1ZGlvRWxlbWVudC5wcmVsb2FkID0gXFxcImF1dG9cXFwiOyAvLyBlbmFibGUgYWdncmVzc2l2ZSBwcmVsb2FkaW5nIG9mIGF1ZGlvXFxudmFyIHBpQXVkaW9NYW5hZ2VyID0ge1xcbiAgaXNTcGVha2luZzogZmFsc2UsXFxuICBhdWRpb0VsZW1lbnQ6IGF1ZGlvRWxlbWVudCxcXG4gIF91c2VyU3RhcnRlZDogdHJ1ZSxcXG4gIC8vIGZsYWcgdG8gaW5kaWNhdGUgcGxheWJhY2sgaGFzIGJlZW4gc3RhcnRlZCBieSB0aGUgdXNlciAodHJ1ZSBieSBkZWZhdWx0IGJlY2F1c2UgdXNlciBtdXN0IHJlcXVlc3QgaW5pdGlhbCBwbGF5YmFjaylcXG4gIF9pc0xvYWRDYWxsZWQ6IGZhbHNlLFxcbiAgLy8gZmxhZyB0byBpbmRpY2F0ZSBpZiB0aGUgbG9hZCgpIG1ldGhvZCBoYXMgYmVlbiBjYWxsZWQgb24gdGhlIGF1ZGlvIGVsZW1lbnRcXG5cXG4gIHVzZXJQbGF5OiBmdW5jdGlvbiB1c2VyUGxheSgpIHtcXG4gICAgaWYgKCFpc1NhZmFyaSgpKSB7XFxuICAgICAgcmV0dXJuO1xcbiAgICB9XFxuICAgIHRoaXMuX3VzZXJTdGFydGVkID0gdHJ1ZTsgLy8gc2V0IGEgZmxhZyB0byBpbmRpY2F0ZSBwbGF5YmFjayBoYXMgYmVlbiBzdGFydGVkIGJ5IHRoZSB1c2VyXFxuICAgIHRoaXMuYXVkaW9FbGVtZW50LmxvYWQoKTsgLy8gcmVzZXQgZm9yIFNhZmFyaVxcbiAgICB0aGlzLmF1ZGlvRWxlbWVudC5wbGF5KCk7XFxuICAgIGNvbnNvbGUubG9nKCdVc2VyIHN0YXJ0ZWQgcGxheWJhY2snKTtcXG4gIH0sXFxuICBhdXRvUGxheTogZnVuY3Rpb24gYXV0b1BsYXkoKSB7XFxuICAgIGlmICghaXNTYWZhcmkoKSkge1xcbiAgICAgIHJldHVybjtcXG4gICAgfVxcbiAgICBpZiAoIXRoaXMuX3VzZXJTdGFydGVkKSB7XFxuICAgICAgdGhpcy5hdWRpb0VsZW1lbnQucGF1c2UoKTtcXG4gICAgICBjb25zb2xlLmxvZygnQXV0b3BsYXkgcHJldmVudGVkJyk7XFxuICAgIH1cXG4gIH0sXFxuICBzdG9wOiBmdW5jdGlvbiBzdG9wKCkge1xcbiAgICBpZiAodGhpcy5pc1NwZWFraW5nKSB7XFxuICAgICAgdGhpcy5hdWRpb0VsZW1lbnQucGF1c2UoKTtcXG4gICAgfVxcbiAgICBpZiAodGhpcy5hdWRpb0VsZW1lbnQuZHVyYXRpb24gJiYgIXRoaXMuYXVkaW9FbGVtZW50LmVuZGVkICYmIHRoaXMuYXVkaW9FbGVtZW50LmN1cnJlbnRUaW1lIDwgdGhpcy5hdWRpb0VsZW1lbnQuZHVyYXRpb24pIHtcXG4gICAgICB0aGlzLmF1ZGlvRWxlbWVudC5jdXJyZW50VGltZSA9IHRoaXMuYXVkaW9FbGVtZW50LmR1cmF0aW9uOyAvLyBzZWVrIHRoZSBhdWRpbyB0byB0aGUgZW5kXFxuICAgICAgdGhpcy5hdWRpb0VsZW1lbnQucGxheSgpOyAvLyB0cmlnZ2VyIHRoZSBlbmRlZCBldmVudFxcbiAgICB9XFxuICB9LFxcblxcbiAgcGF1c2U6IGZ1bmN0aW9uIHBhdXNlKCkge1xcbiAgICB0aGlzLmF1ZGlvRWxlbWVudC5wYXVzZSgpO1xcbiAgfSxcXG4gIHJlc3VtZTogZnVuY3Rpb24gcmVzdW1lKCkge1xcbiAgICB0aGlzLmF1ZGlvRWxlbWVudC5wbGF5KCk7XFxuICB9LFxcbiAgbG9hZGluZzogZnVuY3Rpb24gbG9hZGluZygpIHtcXG4gICAgaWYgKCFpc1NhZmFyaSgpKSB7XFxuICAgICAgcmV0dXJuO1xcbiAgICB9XFxuICAgIGlmICghdGhpcy5faXNMb2FkQ2FsbGVkKSB7XFxuICAgICAgdGhpcy5faXNMb2FkQ2FsbGVkID0gdHJ1ZTsgLy8gU2V0IHRoZSBmbGFnIHRvIHRydWVcXG4gICAgICB0aGlzLnNob3dQbGF5QnV0dG9uKCk7IC8vIFNob3cgdGhlIHBsYXkgYnV0dG9uXFxuICAgIH0gZWxzZSB7XFxuICAgICAgdGhpcy5faXNMb2FkQ2FsbGVkID0gZmFsc2U7IC8vIFJlc2V0IHRoZSBmbGFnXFxuICAgIH1cXG4gIH0sXFxuXFxuICBwbGF5aW5nOiBmdW5jdGlvbiBwbGF5aW5nKCkge1xcbiAgICB0aGlzLmlzU3BlYWtpbmcgPSB0cnVlO1xcbiAgICBpZiAoaXNTYWZhcmkoKSkge1xcbiAgICAgIHRoaXMuaGlkZVBsYXlCdXR0b24oKTtcXG4gICAgfVxcbiAgfSxcXG4gIHN0b3BwZWQ6IGZ1bmN0aW9uIHN0b3BwZWQoKSB7XFxuICAgIHRoaXMuaXNTcGVha2luZyA9IGZhbHNlO1xcbiAgICB0aGlzLl91c2VyU3RhcnRlZCA9IGZhbHNlO1xcbiAgfSxcXG4gIHNob3dQbGF5QnV0dG9uOiBmdW5jdGlvbiBzaG93UGxheUJ1dHRvbigpIHtcXG4gICAgdmFyIHBsYXlCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2F5cGktcGxheUF1ZGlvJyk7XFxuICAgIGlmICghcGxheUJ1dHRvbikge1xcbiAgICAgIHBsYXlCdXR0b24gPSB0aGlzLmNyZWF0ZVBsYXlCdXR0b24oKTtcXG4gICAgfVxcbiAgICBwbGF5QnV0dG9uLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xcbiAgfSxcXG4gIGhpZGVQbGF5QnV0dG9uOiBmdW5jdGlvbiBoaWRlUGxheUJ1dHRvbigpIHtcXG4gICAgdmFyIHBsYXlCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2F5cGktcGxheUF1ZGlvJyk7XFxuICAgIGlmIChwbGF5QnV0dG9uKSB7XFxuICAgICAgcGxheUJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xcbiAgICB9XFxuICB9LFxcbiAgY3JlYXRlUGxheUJ1dHRvbjogZnVuY3Rpb24gY3JlYXRlUGxheUJ1dHRvbigpIHtcXG4gICAgdmFyIF90aGlzID0gdGhpcztcXG4gICAgdmFyIHBsYXlCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcXG4gICAgcGxheUJ1dHRvbi5pZCA9ICdzYXlwaS1wbGF5QXVkaW8nO1xcbiAgICBwbGF5QnV0dG9uLmlubmVyVGV4dCA9ICdIZWFyIFBpXFxcXCdzIFJlc3BvbnNlJztcXG4gICAgcGxheUJ1dHRvbi5zdHlsZS5wb3NpdGlvbiA9ICdmaXhlZCc7XFxuICAgIHBsYXlCdXR0b24uc3R5bGUudG9wID0gJzUwJSc7XFxuICAgIHBsYXlCdXR0b24uc3R5bGUubGVmdCA9ICc1MCUnO1xcbiAgICBwbGF5QnV0dG9uLnN0eWxlLnRyYW5zZm9ybSA9ICd0cmFuc2xhdGUoLTUwJSwgNTAlKSc7XFxuICAgIHBsYXlCdXR0b24uc3R5bGUucGFkZGluZyA9ICcxMHB4IDIwcHgnO1xcbiAgICBwbGF5QnV0dG9uLnN0eWxlLmZvbnRTaXplID0gJzI0cHgnO1xcbiAgICBwbGF5QnV0dG9uLnN0eWxlLmJvcmRlclJhZGl1cyA9ICc1cHgnO1xcbiAgICBwbGF5QnV0dG9uLnN0eWxlLmJvcmRlciA9ICdub25lJztcXG4gICAgcGxheUJ1dHRvbi5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAncmdiKDIyOCAyMTYgMTkzKSc7XFxuICAgIHBsYXlCdXR0b24uc3R5bGUuekluZGV4ID0gJzk5OTknOyAvLyBlbnN1cmUgaXQncyBvbiB0b3Agb2Ygb3RoZXIgZWxlbWVudHNcXG4gICAgcGxheUJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOyAvLyBpbml0aWFsbHkgaGlkZGVuXFxuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQocGxheUJ1dHRvbik7XFxuXFxuICAgIC8vIEV2ZW50IGxpc3RlbmVyIHRvIHN0YXJ0IHBsYXliYWNrXFxuICAgIHBsYXlCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7XFxuICAgICAgX3RoaXMudXNlclBsYXkoKTtcXG4gICAgICBfdGhpcy5oaWRlUGxheUJ1dHRvbigpO1xcbiAgICB9KTtcXG4gICAgcmV0dXJuIHBsYXlCdXR0b247XFxuICB9XFxufTtcXG5cXG4vLyBJbnRlcmNlcHQgQXV0b3BsYXkgRXZlbnRzIChhdXRvcGxheSBkb2Vzbid0IHdvcmsgb24gU2FmYXJpKVxcbmF1ZGlvRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdwbGF5JywgZnVuY3Rpb24gKCkge1xcbiAgcGlBdWRpb01hbmFnZXIuYXV0b1BsYXkoKTtcXG59KTtcXG5hdWRpb0VsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbG9hZHN0YXJ0JywgZnVuY3Rpb24gKCkge1xcbiAgcGlBdWRpb01hbmFnZXIubG9hZGluZygpO1xcbn0pO1xcblxcbi8vIEV2ZW50IGxpc3RlbmVycyBmb3IgZGV0ZWN0aW5nIHdoZW4gUGkgaXMgc3BlYWtpbmdcXG5hdWRpb0VsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigncGxheWluZycsIGZ1bmN0aW9uICgpIHtcXG4gIGNvbnNvbGUubG9nKCdQaSBpcyBzcGVha2luZycpO1xcbiAgcGlBdWRpb01hbmFnZXIucGxheWluZygpO1xcbn0pO1xcbmF1ZGlvRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdwYXVzZScsIGZ1bmN0aW9uICgpIHtcXG4gIGNvbnNvbGUubG9nKCdQaSBzdG9wcGVkIHNwZWFraW5nJyk7XFxuICBwaUF1ZGlvTWFuYWdlci5zdG9wcGVkKCk7XFxufSk7XFxuYXVkaW9FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2VuZGVkJywgZnVuY3Rpb24gKCkge1xcbiAgY29uc29sZS5sb2coJ1BpIGZpbmlzaGVkIHNwZWFraW5nJyk7XFxuICBwaUF1ZGlvTWFuYWdlci5zdG9wcGVkKCk7XFxufSk7XFxuXFxuLy8gYXVkaW8gaW5wdXQgKHVzZXIpXFxudmFyIGF1ZGlvRGF0YUNodW5rcyA9IFtdO1xcbnZhciBhdWRpb01pbWVUeXBlID0gJ2F1ZGlvL3dlYm07Y29kZWNzPW9wdXMnO1xcbmZ1bmN0aW9uIHVwbG9hZEF1ZGlvKGF1ZGlvQmxvYikge1xcbiAgLy8gQ3JlYXRlIGEgRm9ybURhdGEgb2JqZWN0XFxuICB2YXIgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcXG4gIHZhciBhdWRpb0ZpbGVuYW1lID0gJ2F1ZGlvLndlYm0nO1xcbiAgaWYgKGF1ZGlvQmxvYi50eXBlID09PSAnYXVkaW8vbXA0Jykge1xcbiAgICBhdWRpb0ZpbGVuYW1lID0gJ2F1ZGlvLm1wNCc7XFxuICB9XFxuICAvLyBBZGQgdGhlIGF1ZGlvIGJsb2IgdG8gdGhlIEZvcm1EYXRhIG9iamVjdFxcbiAgZm9ybURhdGEuYXBwZW5kKCdhdWRpbycsIGF1ZGlvQmxvYiwgYXVkaW9GaWxlbmFtZSk7XFxuICAvLyBHZXQgdGhlIHVzZXIncyBwcmVmZXJyZWQgbGFuZ3VhZ2VcXG4gIHZhciBsYW5ndWFnZSA9IG5hdmlnYXRvci5sYW5ndWFnZTtcXG4gIC8vIFBvc3QgdGhlIGF1ZGlvIHRvIHRoZSBzZXJ2ZXIgZm9yIHRyYW5zY3JpcHRpb25cXG4gIGZldGNoKGNvbmZpZy5hcGlTZXJ2ZXJVcmwgKyAnL3RyYW5zY3JpYmU/bGFuZ3VhZ2U9JyArIGxhbmd1YWdlLCB7XFxuICAgIG1ldGhvZDogJ1BPU1QnLFxcbiAgICBib2R5OiBmb3JtRGF0YVxcbiAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcXG4gICAgaWYgKCFyZXNwb25zZS5vaykge1xcbiAgICAgIHRocm93IEVycm9yKHJlc3BvbnNlLnN0YXR1c1RleHQpO1xcbiAgICB9XFxuICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XFxuICB9KS50aGVuKGhhbmRsZVRyYW5zY3JpcHRpb25SZXNwb25zZSlbXFxcImNhdGNoXFxcIl0oZnVuY3Rpb24gKGVycm9yKSB7XFxuICAgIGNvbnNvbGUuZXJyb3IoJ0xvb2tzIGxpa2UgdGhlcmUgd2FzIGEgcHJvYmxlbTogJywgZXJyb3IpO1xcbiAgICB2YXIgdGV4dGFyZWEgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvbXB0Jyk7XFxuICAgIHRleHRhcmVhLnZhbHVlID0gJ1NvcnJ5LCB0aGVyZSB3YXMgYSBwcm9ibGVtIHRyYW5zY3JpYmluZyB5b3VyIGF1ZGlvLiBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyLic7XFxuICB9KTtcXG59XFxuZnVuY3Rpb24gaGFuZGxlVHJhbnNjcmlwdGlvblJlc3BvbnNlKHJlc3BvbnNlSnNvbikge1xcbiAgdmFyIHRleHRhcmVhID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb21wdCcpO1xcbiAgc2ltdWxhdGVUeXBpbmcodGV4dGFyZWEsIHJlc3BvbnNlSnNvbi50ZXh0ICsgXFxcIiBcXFwiKTtcXG4gIGNvbnNvbGUubG9nKCdUcmFuc2NyaXB0OiAnICsgcmVzcG9uc2VKc29uLnRleHQpO1xcbn1cXG5mdW5jdGlvbiBzZXROYXRpdmVWYWx1ZShlbGVtZW50LCB2YWx1ZSkge1xcbiAgdmFyIGxhc3RWYWx1ZSA9IGVsZW1lbnQudmFsdWU7XFxuICBlbGVtZW50LnZhbHVlID0gdmFsdWU7XFxuICB2YXIgZXZlbnQgPSBuZXcgRXZlbnQoXFxcImlucHV0XFxcIiwge1xcbiAgICB0YXJnZXQ6IGVsZW1lbnQsXFxuICAgIGJ1YmJsZXM6IHRydWVcXG4gIH0pO1xcbiAgLy8gUmVhY3QgMTVcXG4gIGV2ZW50LnNpbXVsYXRlZCA9IHRydWU7XFxuICAvLyBSZWFjdCAxNi0xN1xcbiAgdmFyIHRyYWNrZXIgPSBlbGVtZW50Ll92YWx1ZVRyYWNrZXI7XFxuICBpZiAodHJhY2tlcikge1xcbiAgICB0cmFja2VyLnNldFZhbHVlKGxhc3RWYWx1ZSk7XFxuICB9XFxuICBlbGVtZW50LmRpc3BhdGNoRXZlbnQoZXZlbnQpO1xcbn1cXG5mdW5jdGlvbiBzaW11bGF0ZUZvcm1TdWJtaXQodGV4dGFyZWEpIHtcXG4gIHZhciBlbnRlckV2ZW50ID0gbmV3IEtleWJvYXJkRXZlbnQoJ2tleWRvd24nLCB7XFxuICAgIGJ1YmJsZXM6IHRydWUsXFxuICAgIGtleTogJ0VudGVyJyxcXG4gICAga2V5Q29kZTogMTMsXFxuICAgIHdoaWNoOiAxM1xcbiAgfSk7XFxuICB0ZXh0YXJlYS5kaXNwYXRjaEV2ZW50KGVudGVyRXZlbnQpO1xcbn1cXG5mdW5jdGlvbiBzaW11bGF0ZVR5cGluZyhlbGVtZW50LCB0ZXh0KSB7XFxuICB2YXIgd29yZHMgPSB0ZXh0LnNwbGl0KCcgJyk7IC8vIFNwbGl0IHRoZSB0ZXh0IGludG8gd29yZHMgKG1heSBub3QgYmUgaWRlYWwgZm9yIGFsbCBsYW5ndWFnZXMpXFxuICB2YXIgaSA9IDA7XFxuICBmdW5jdGlvbiB0eXBlV29yZCgpIHtcXG4gICAgaWYgKGkgPCB3b3Jkcy5sZW5ndGgpIHtcXG4gICAgICAvLyBBcHBlbmQgdGhlIG5leHQgd29yZCBhbmQgYSBzcGFjZSwgdGhlbiBpbmNyZW1lbnQgaVxcbiAgICAgIHNldE5hdGl2ZVZhbHVlKGVsZW1lbnQsIGVsZW1lbnQudmFsdWUgKyB3b3Jkc1tpKytdICsgJyAnKTtcXG4gICAgICAvLyBDYWxsIHRoaXMgZnVuY3Rpb24gYWdhaW4gYmVmb3JlIHRoZSBuZXh0IHJlcGFpbnRcXG4gICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUodHlwZVdvcmQpO1xcbiAgICB9IGVsc2Uge1xcbiAgICAgIC8vIENoZWNrIGlmIGF1dG9zdWJtaXQgaXMgZW5hYmxlZFxcbiAgICAgIHZhciB0YWxrQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RhbGtCdXR0b24nKTtcXG4gICAgICBpZiAodGFsa0J1dHRvbi5kYXRhc2V0LmF1dG9zdWJtaXQgPT09ICdmYWxzZScpIHtcXG4gICAgICAgIGNvbnNvbGUubG9nKCdBdXRvc3VibWl0IGlzIGRpc2FibGVkJyk7XFxuICAgICAgfSBlbHNlIHtcXG4gICAgICAgIC8vIFNpbXVsYXRlIGFuIFxcXCJFbnRlclxcXCIga2V5cHJlc3MgZXZlbnRcXG4gICAgICAgIHNpbXVsYXRlRm9ybVN1Ym1pdChlbGVtZW50KTtcXG4gICAgICB9XFxuICAgIH1cXG4gIH1cXG4gIC8vIFN0YXJ0IHR5cGluZ1xcbiAgdHlwZVdvcmQoKTtcXG59XFxuXFxuLy8gRGVjbGFyZSBhIGdsb2JhbCB2YXJpYWJsZSBmb3IgdGhlIG1lZGlhUmVjb3JkZXJcXG52YXIgbWVkaWFSZWNvcmRlcjtcXG52YXIgdGhyZXNob2xkID0gMTAwMDsgLy8gMTAwMCBtcyA9IDEgc2Vjb25kLCBhYm91dCB0aGUgbGVuZ3RoIG9mIFxcXCJIZXksIFBpXFxcIlxcblxcbi8vIFRoaXMgZnVuY3Rpb24gd2lsbCBiZSBjYWxsZWQgd2hlbiB0aGUgJ2RhdGFhdmFpbGFibGUnIGV2ZW50IGZpcmVzXFxuZnVuY3Rpb24gaGFuZGxlRGF0YUF2YWlsYWJsZShlKSB7XFxuICAvLyBBZGQgdGhlIGF1ZGlvIGRhdGEgY2h1bmsgdG8gdGhlIGFycmF5XFxuICBhdWRpb0RhdGFDaHVua3MucHVzaChlLmRhdGEpO1xcbn1cXG5cXG4vLyBUaGlzIGZ1bmN0aW9uIHdpbGwgYmUgY2FsbGVkIHdoZW4gdGhlICdzdG9wJyBldmVudCBmaXJlc1xcbmZ1bmN0aW9uIGhhbmRsZVN0b3AoKSB7XFxuICAvLyBDcmVhdGUgYSBCbG9iIGZyb20gdGhlIGF1ZGlvIGRhdGEgY2h1bmtzXFxuICB2YXIgYXVkaW9CbG9iID0gbmV3IEJsb2IoYXVkaW9EYXRhQ2h1bmtzLCB7XFxuICAgIHR5cGU6IGF1ZGlvTWltZVR5cGVcXG4gIH0pO1xcblxcbiAgLy8gR2V0IHRoZSBzdG9wIHRpbWUgYW5kIGNhbGN1bGF0ZSB0aGUgZHVyYXRpb25cXG4gIHZhciBzdG9wVGltZSA9IERhdGUubm93KCk7XFxuICB2YXIgZHVyYXRpb24gPSBzdG9wVGltZSAtIHdpbmRvdy5zdGFydFRpbWU7XFxuXFxuICAvLyBJZiB0aGUgZHVyYXRpb24gaXMgZ3JlYXRlciB0aGFuIHRoZSB0aHJlc2hvbGQsIHVwbG9hZCB0aGUgYXVkaW8gZm9yIHRyYW5zY3JpcHRpb25cXG4gIGlmIChkdXJhdGlvbiA+PSB0aHJlc2hvbGQpIHtcXG4gICAgLy8gZG93bmxvYWQgdGhlIGF1ZGlvXFxuICAgIHZhciB1cmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGF1ZGlvQmxvYik7XFxuICAgIHZhciBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xcbiAgICBhLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XFxuICAgIGEuaHJlZiA9IHVybDtcXG4gICAgYS5kb3dubG9hZCA9ICdzYWZhcmlfYXVkaW8ubXA0JztcXG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhKTtcXG4gICAgLy8gYS5jbGljaygpO1xcbiAgICAvLyBVcGxvYWQgdGhlIGF1ZGlvIHRvIHRoZSBzZXJ2ZXIgZm9yIHRyYW5zY3JpcHRpb25cXG4gICAgdXBsb2FkQXVkaW8oYXVkaW9CbG9iKTtcXG4gIH1cXG5cXG4gIC8vIENsZWFyIHRoZSBhcnJheSBmb3IgdGhlIG5leHQgcmVjb3JkaW5nXFxuICBhdWRpb0RhdGFDaHVua3MgPSBbXTtcXG59XFxuZnVuY3Rpb24gc2V0dXBSZWNvcmRpbmcoY2FsbGJhY2spIHtcXG4gIGlmIChtZWRpYVJlY29yZGVyKSB7XFxuICAgIHJldHVybjtcXG4gIH1cXG5cXG4gIC8vIEdldCBhIHN0cmVhbSBmcm9tIHRoZSB1c2VyJ3MgbWljcm9waG9uZVxcbiAgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEoe1xcbiAgICBhdWRpbzogdHJ1ZVxcbiAgfSkudGhlbihmdW5jdGlvbiAoc3RyZWFtKSB7XFxuICAgIGlmICghTWVkaWFSZWNvcmRlci5pc1R5cGVTdXBwb3J0ZWQoYXVkaW9NaW1lVHlwZSkpIHtcXG4gICAgICAvLyB1c2UgTVA0IGZvciBTYWZhcmlcXG4gICAgICBhdWRpb01pbWVUeXBlID0gJ2F1ZGlvL21wNCc7XFxuICAgIH1cXG4gICAgLy8gQ3JlYXRlIGEgbmV3IE1lZGlhUmVjb3JkZXIgb2JqZWN0IHVzaW5nIHRoZSBzdHJlYW0gYW5kIHNwZWNpZnlpbmcgdGhlIE1JTUUgdHlwZVxcbiAgICB2YXIgb3B0aW9ucyA9IHtcXG4gICAgICBtaW1lVHlwZTogYXVkaW9NaW1lVHlwZVxcbiAgICB9O1xcbiAgICBtZWRpYVJlY29yZGVyID0gbmV3IE1lZGlhUmVjb3JkZXIoc3RyZWFtLCBvcHRpb25zKTtcXG5cXG4gICAgLy8gTGlzdGVuIGZvciB0aGUgJ2RhdGFhdmFpbGFibGUnIGV2ZW50XFxuICAgIG1lZGlhUmVjb3JkZXIuYWRkRXZlbnRMaXN0ZW5lcignZGF0YWF2YWlsYWJsZScsIGhhbmRsZURhdGFBdmFpbGFibGUpO1xcblxcbiAgICAvLyBMaXN0ZW4gZm9yIHRoZSAnc3RvcCcgZXZlbnRcXG4gICAgbWVkaWFSZWNvcmRlci5hZGRFdmVudExpc3RlbmVyKCdzdG9wJywgaGFuZGxlU3RvcCk7XFxuICB9KS50aGVuKGZ1bmN0aW9uICgpIHtcXG4gICAgLy8gSW52b2tlIHRoZSBjYWxsYmFjayBmdW5jdGlvblxcbiAgICBpZiAodHlwZW9mIGNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSB7XFxuICAgICAgY2FsbGJhY2soKTtcXG4gICAgfVxcbiAgfSlbXFxcImNhdGNoXFxcIl0oZnVuY3Rpb24gKGVycikge1xcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBnZXR0aW5nIGF1ZGlvIHN0cmVhbTogJyArIGVycik7XFxuICB9KTtcXG59XFxuZnVuY3Rpb24gdGVhckRvd25SZWNvcmRpbmcoKSB7XFxuICAvLyBDaGVjayBpZiB0aGUgTWVkaWFSZWNvcmRlciBpcyBzZXQgdXBcXG4gIGlmICghbWVkaWFSZWNvcmRlcikge1xcbiAgICByZXR1cm47XFxuICB9XFxuXFxuICAvLyBTdG9wIGFueSBvbmdvaW5nIHJlY29yZGluZ1xcbiAgaWYgKG1lZGlhUmVjb3JkZXIuc3RhdGUgPT09ICdyZWNvcmRpbmcnKSB7XFxuICAgIG1lZGlhUmVjb3JkZXIuc3RvcCgpO1xcbiAgfVxcblxcbiAgLy8gUmVtb3ZlIHRoZSBNZWRpYVJlY29yZGVyJ3MgZXZlbnQgbGlzdGVuZXJzXFxuICBtZWRpYVJlY29yZGVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2RhdGFhdmFpbGFibGUnLCBoYW5kbGVEYXRhQXZhaWxhYmxlKTtcXG4gIG1lZGlhUmVjb3JkZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcignc3RvcCcsIGhhbmRsZVN0b3ApO1xcblxcbiAgLy8gQ2xlYXIgdGhlIE1lZGlhUmVjb3JkZXIgdmFyaWFibGVcXG4gIG1lZGlhUmVjb3JkZXIgPSBudWxsO1xcbn1cXG5cXG4vLyBUaGlzIGZ1bmN0aW9uIHdpbGwgYmUgY2FsbGVkIHdoZW4gdGhlIHVzZXIgcHJlc3NlcyB0aGUgcmVjb3JkIGJ1dHRvblxcbmZ1bmN0aW9uIHN0YXJ0UmVjb3JkaW5nKCkge1xcbiAgLy8gQ2hlY2sgaWYgdGhlIE1lZGlhUmVjb3JkZXIgaXMgc2V0IHVwXFxuICBpZiAoIW1lZGlhUmVjb3JkZXIpIHtcXG4gICAgc2V0dXBSZWNvcmRpbmcoc3RhcnRSZWNvcmRpbmcpO1xcbiAgICByZXR1cm47XFxuICB9XFxuICAvLyBDaGVjayBpZiBQaSBpcyBjdXJyZW50bHkgc3BlYWtpbmcgYW5kIHN0b3AgaGVyIGF1ZGlvXFxuICBpZiAocGlBdWRpb01hbmFnZXIuaXNTcGVha2luZykge1xcbiAgICBwaUF1ZGlvTWFuYWdlci5wYXVzZSgpO1xcbiAgfVxcblxcbiAgLy8gU3RhcnQgcmVjb3JkaW5nXFxuICBtZWRpYVJlY29yZGVyLnN0YXJ0KCk7XFxuXFxuICAvLyBSZWNvcmQgdGhlIHN0YXJ0IHRpbWVcXG4gIHdpbmRvdy5zdGFydFRpbWUgPSBEYXRlLm5vdygpO1xcbiAgY29uc29sZS5sb2coJ1VzZXIgaXMgc3BlYWtpbmcnKTtcXG5cXG4gIC8vIFRoaXMgZnVuY3Rpb24gd2lsbCBiZSBjYWxsZWQgd2hlbiB0aGUgdXNlciByZWxlYXNlcyB0aGUgcmVjb3JkIGJ1dHRvblxcbiAgd2luZG93LnN0b3BSZWNvcmRpbmcgPSBmdW5jdGlvbiAoKSB7XFxuICAgIGlmIChtZWRpYVJlY29yZGVyICYmIG1lZGlhUmVjb3JkZXIuc3RhdGUgPT09ICdyZWNvcmRpbmcnKSB7XFxuICAgICAgLy8gU3RvcCByZWNvcmRpbmdcXG4gICAgICBtZWRpYVJlY29yZGVyLnN0b3AoKTtcXG5cXG4gICAgICAvLyBSZWNvcmQgdGhlIHN0b3AgdGltZSBhbmQgY2FsY3VsYXRlIHRoZSBkdXJhdGlvblxcbiAgICAgIHZhciBzdG9wVGltZSA9IERhdGUubm93KCk7XFxuICAgICAgdmFyIGR1cmF0aW9uID0gc3RvcFRpbWUgLSB3aW5kb3cuc3RhcnRUaW1lO1xcblxcbiAgICAgIC8vIElmIHRoZSBkdXJhdGlvbiBpcyBsZXNzIHRoYW4gdGhlIHRocmVzaG9sZCwgZG9uJ3QgdXBsb2FkIHRoZSBhdWRpbyBmb3IgdHJhbnNjcmlwdGlvblxcbiAgICAgIGlmIChkdXJhdGlvbiA8IHRocmVzaG9sZCkge1xcbiAgICAgICAgY29uc29sZS5sb2coJ1VzZXIgc3RvcHBlZCBzcGVha2luZycpO1xcbiAgICAgICAgY29uc29sZS5sb2coJ1JlY29yZGluZyB3YXMgdG9vIHNob3J0LCBub3QgdXBsb2FkaW5nIGZvciB0cmFuc2NyaXB0aW9uJyk7XFxuICAgICAgICBwaUF1ZGlvTWFuYWdlci5yZXN1bWUoKTtcXG4gICAgICB9IGVsc2Uge1xcbiAgICAgICAgY29uc29sZS5sb2coJ1VzZXIgZmluaXNoZWQgc3BlYWtpbmcnKTtcXG4gICAgICAgIHBpQXVkaW9NYW5hZ2VyLnN0b3AoKTtcXG4gICAgICB9XFxuICAgIH1cXG4gICAgLy8gUmVtb3ZlIHRoZSBzdG9wUmVjb3JkaW5nIGZ1bmN0aW9uXFxuICAgIGRlbGV0ZSB3aW5kb3cuc3RvcFJlY29yZGluZztcXG4gIH07XFxufVxcblxcbi8vIEFkZCB0aGUgc3RhcnRSZWNvcmRpbmcgZnVuY3Rpb24gdG8gdGhlIHdpbmRvdyBvYmplY3Qgc28gaXQgY2FuIGJlIGNhbGxlZCBmcm9tIG91dHNpZGUgdGhpcyBzY3JpcHRcXG53aW5kb3cuc3RhcnRSZWNvcmRpbmcgPSBzdGFydFJlY29yZGluZztcIjsiLCIvLyBUaGUgbW9kdWxlIGNhY2hlXG52YXIgX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fID0ge307XG5cbi8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG5mdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuXHR2YXIgY2FjaGVkTW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXTtcblx0aWYgKGNhY2hlZE1vZHVsZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0cmV0dXJuIGNhY2hlZE1vZHVsZS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdKG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuIiwiLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbnMgZm9yIGhhcm1vbnkgZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gKGV4cG9ydHMsIGRlZmluaXRpb24pID0+IHtcblx0Zm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTtcblx0XHR9XG5cdH1cbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gKG9iaiwgcHJvcCkgPT4gKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApKSIsIi8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uciA9IChleHBvcnRzKSA9PiB7XG5cdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuXHR9XG5cdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG59OyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgY29uc3QgbG9jYWxDb25maWcgPSB7XG4gICAgICAgIGFwcFNlcnZlclVybDogXCJodHRwOi8vbG9jYWxob3N0OjMwMDBcIixcbiAgICAgICAgYXBpU2VydmVyVXJsOiBcImh0dHBzOi8vbG9jYWxob3N0OjUwMDBcIixcbiAgICAgICAgLy8gQWRkIG90aGVyIGNvbmZpZ3VyYXRpb24gcHJvcGVydGllcyBhcyBuZWVkZWRcbiAgICB9O1xuXG4gICAgLy8gRGVmaW5lIGEgZ2xvYmFsIGNvbmZpZ3VyYXRpb24gcHJvcGVydHlcbiAgICBjb25zdCBwcm9kdWN0aW9uQ29uZmlnID0ge1xuICAgICAgICBhcHBTZXJ2ZXJVcmw6IFwiaHR0cHM6Ly9hcHAuc2F5cGkuYWlcIixcbiAgICAgICAgYXBpU2VydmVyVXJsOiBcImh0dHBzOi8vYXBpLnNheXBpLmFpXCIsXG4gICAgICAgIC8vIEFkZCBvdGhlciBjb25maWd1cmF0aW9uIHByb3BlcnRpZXMgYXMgbmVlZGVkXG4gICAgfTtcbiAgICBjb25zdCBjb25maWcgPSBwcm9kdWN0aW9uQ29uZmlnO1xuXG4gICAgY29uc3QgcGFnZVNjcmlwdCA9IHJlcXVpcmUoJ3Jhdy1sb2FkZXIhLi90cmFuc2NyaWJlci5qcycpLmRlZmF1bHQ7XG5cbiAgICAvLyBDcmVhdGUgYSBNdXRhdGlvbk9ic2VydmVyIHRvIGxpc3RlbiBmb3IgY2hhbmdlcyB0byB0aGUgRE9NXG4gICAgdmFyIG9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoZnVuY3Rpb24gKG11dGF0aW9ucykge1xuICAgICAgICAvLyBDaGVjayBlYWNoIG11dGF0aW9uXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbXV0YXRpb25zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgbXV0YXRpb24gPSBtdXRhdGlvbnNbaV07XG5cbiAgICAgICAgICAgIC8vIElmIG5vZGVzIHdlcmUgYWRkZWQsIGNoZWNrIGVhY2ggb25lXG4gICAgICAgICAgICBpZiAobXV0YXRpb24uYWRkZWROb2Rlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBtdXRhdGlvbi5hZGRlZE5vZGVzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBub2RlID0gbXV0YXRpb24uYWRkZWROb2Rlc1tqXTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGUgbm9kZSBpcyB0aGUgYXBwcm9wcmlhdGUgY29udGFpbmVyIGVsZW1lbnQsIGFkZCB0aGUgYnV0dG9uIGFuZCBzdG9wIG9ic2VydmluZ1xuICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSAnZGl2JyAmJiBub2RlLmNsYXNzTGlzdC5jb250YWlucygnZml4ZWQnKSAmJiBub2RlLmNsYXNzTGlzdC5jb250YWlucygnYm90dG9tLTE2JykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmb290ZXIgPSBub2RlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGJ1dHRvbkNvbnRhaW5lciA9IGZvb3Rlci5xdWVyeVNlbGVjdG9yKCcucmVsYXRpdmUuZmxleC5mbGV4LWNvbCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJ1dHRvbkNvbnRhaW5lcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZFRhbGtCdXR0b24oYnV0dG9uQ29udGFpbmVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ05vIGJ1dHRvbiBjb250YWluZXIgZm91bmQgaW4gZm9vdGVyJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5kaXNjb25uZWN0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcblxuXG4gICAgZnVuY3Rpb24gaW5qZWN0U2NyaXB0KGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBzY3JpcHRFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNjcmlwdFwiKTtcbiAgICAgICAgc2NyaXB0RWxlbWVudC50eXBlID0gXCJ0ZXh0L2phdmFzY3JpcHRcIjtcbiAgICAgICAgc2NyaXB0RWxlbWVudC5pZCA9ICdzYXlwaS1zY3JpcHQnO1xuICAgICAgICBjb25zdCBjb25maWdUZXh0ID0gJ3ZhciBjb25maWcgPSAnICsgSlNPTi5zdHJpbmdpZnkoY29uZmlnKSArICc7JztcbiAgICAgICAgc2NyaXB0RWxlbWVudC50ZXh0Q29udGVudCA9IGNvbmZpZ1RleHQgKyBwYWdlU2NyaXB0O1xuICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHNjcmlwdEVsZW1lbnQpO1xuXG4gICAgICAgIC8vIENhbGwgdGhlIGNhbGxiYWNrIGZ1bmN0aW9uIGFmdGVyIHRoZSBzY3JpcHQgaXMgYWRkZWRcbiAgICAgICAgaWYgKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICB9XG4gICAgfVxuXG5cbiAgICBmdW5jdGlvbiBhZGRUYWxrQnV0dG9uKGNvbnRhaW5lcikge1xuICAgICAgICB2YXIgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XG4gICAgICAgIGJ1dHRvbi5pZCA9ICd0YWxrQnV0dG9uJztcbiAgICAgICAgYnV0dG9uLnR5cGUgPSAnYnV0dG9uJztcbiAgICAgICAgYnV0dG9uLmNsYXNzTmFtZSA9ICdyZWxhdGl2ZSBmbGV4IG10LTEgbWItMSByb3VuZGVkLWZ1bGwgcHgtMiBweS0zIHRleHQtY2VudGVyIGJnLWNyZWFtLTU1MCBob3ZlcjpiZy1jcmVhbS02NTAgaG92ZXI6dGV4dC1icmFuZC1ncmVlbi03MDAgdGV4dC1tdXRlZCc7XG4gICAgICAgIC8vIFNldCBBUklBIGxhYmVsIGFuZCB0b29sdGlwXG4gICAgICAgIGNvbnN0IGxhYmVsID0gJ1RhbGsgKEhvbGQgQ29udHJvbCArIFNwYWNlIHRvIHVzZSBob3RrZXkuIERvdWJsZSBjbGljayB0byB0b2dnbGUgYXV0by1zdWJtaXQgb24vb2ZmKSdcbiAgICAgICAgYnV0dG9uLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIGxhYmVsKTtcbiAgICAgICAgYnV0dG9uLnNldEF0dHJpYnV0ZSgndGl0bGUnLCBsYWJlbCk7XG4gICAgICAgIC8vIGVuYWJsZSBhdXRvc3VibWl0IGJ5IGRlZmF1bHRcbiAgICAgICAgYnV0dG9uLmRhdGFzZXQuYXV0b3N1Ym1pdCA9ICd0cnVlJztcbiAgICAgICAgYnV0dG9uLmNsYXNzTGlzdC5hZGQoJ2F1dG9TdWJtaXQnKTtcbiAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGJ1dHRvbik7XG4gICAgICAgIGFkZFRhbGtCdXR0b25TdHlsZXMoKTtcbiAgICAgICAgYWRkVGFsa0ljb24oYnV0dG9uKTtcblxuICAgICAgICAvLyBDYWxsIHRoZSBmdW5jdGlvbiB0byBpbmplY3QgdGhlIHNjcmlwdCBhZnRlciB0aGUgYnV0dG9uIGhhcyBiZWVuIGFkZGVkXG4gICAgICAgIGluamVjdFNjcmlwdChyZWdpc3RlckF1ZGlvQnV0dG9uRXZlbnRzKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBhZGRUYWxrSWNvbihidXR0b24pIHtcbiAgICAgICAgdmFyIGljb25IdG1sID0gYFxuICAgICAgICA8c3ZnIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiB2ZXJzaW9uPVwiMS4wXCIgdmlld0JveD1cIjAgMCA1Ni4yNSAzMFwiIGNsYXNzPVwid2F2ZWZvcm1cIj5cbiAgICAgICAgPGRlZnM+XG4gICAgICAgICAgICA8Y2xpcFBhdGggaWQ9XCJhXCI+XG4gICAgICAgICAgICAgICAgPHBhdGggZD1cIk0uNTQgMTJIM3Y1SC41NFptMCAwXCIvPlxuICAgICAgICAgICAgPC9jbGlwUGF0aD5cbiAgICAgICAgICAgIDxjbGlwUGF0aCBpZD1cImJcIj5cbiAgICAgICAgICAgICAgICA8cGF0aCBkPVwiTTI1IDIuMmgydjI0LjY4aC0yWm0wIDBcIi8+XG4gICAgICAgICAgICA8L2NsaXBQYXRoPlxuICAgICAgICAgICAgPGNsaXBQYXRoIGlkPVwiY1wiPlxuICAgICAgICAgICAgICAgIDxwYXRoIGQ9XCJNNTMgMTJoMS45OHY1SDUzWm0wIDBcIi8+XG4gICAgICAgICAgICA8L2NsaXBQYXRoPlxuICAgICAgICA8L2RlZnM+XG4gICAgICAgIDxnIGNsaXAtcGF0aD1cInVybCgjYSlcIj5cbiAgICAgICAgICAgIDxwYXRoIGQ9XCJNMS40OCAxMi43MWMtLjUgMC0uOS40LS45Ljl2MS44NWEuOS45IDAgMCAwIDEuOCAwdi0xLjg0YzAtLjUtLjQtLjktLjktLjlabTAgMFwiLz5cbiAgICAgICAgPC9nPlxuICAgICAgICA8cGF0aCBkPVwiTTQuOTggNi42M2MtLjUgMC0uOS40LS45Ljl2MTQuMDFhLjkuOSAwIDAgMCAxLjgxIDB2LTE0YzAtLjUtLjQtLjkyLS45LS45MlptMy41MSAzLjFhLjkuOSAwIDAgMC0uOS45MXY3Ljc5YS45LjkgMCAwIDAgMS44IDB2LTcuNzljMC0uNS0uNC0uOS0uOS0uOVpNMTIgMy44M2EuOS45IDAgMCAwLS45MS45djE5LjZhLjkuOSAwIDAgMCAxLjggMFY0Ljc0YzAtLjUtLjQtLjktLjktLjlabTMuNSA4LjI5YS45LjkgMCAwIDAtLjkxLjl2My4wM2EuOS45IDAgMCAwIDEuODEgMHYtMy4wM2MwLS41LS40LS45LS45LS45Wk0xOSA2LjhjLS41IDAtLjkuNC0uOS45djEzLjY4YS45LjkgMCAwIDAgMS44IDBWNy43YzAtLjUtLjQtLjktLjktLjlabTMuNTgtMi45N2gtLjAxYy0uNSAwLS45LjQtLjkuOWwtLjEzIDE5LjZjMCAuNS40LjkuOS45MS41IDAgLjktLjQuOS0uOWwuMTQtMTkuNmEuOS45IDAgMCAwLS45LS45Wm0wIDBcIi8+XG4gICAgICAgIDxnIGNsaXAtcGF0aD1cInVybCgjYilcIj5cbiAgICAgICAgICAgIDxwYXRoIGQ9XCJNMjYgMi4yYy0uNSAwLS45LjQtLjkuOXYyMi44NmEuOS45IDAgMSAwIDEuODEgMFYzLjExYS45LjkgMCAwIDAtLjktLjkxWm0wIDBcIi8+XG4gICAgICAgIDwvZz5cbiAgICAgICAgPHBhdGggZD1cIk0yOS41MiA3LjcxYS45LjkgMCAwIDAtLjkxLjl2MTEuODVhLjkuOSAwIDAgMCAxLjgxIDBWOC42MmMwLS41LS40LS45LS45LS45Wm0zLjUgMi45M2EuOS45IDAgMCAwLS45LjkxdjUuOTdhLjkuOSAwIDAgMCAxLjggMHYtNS45N2MwLS41LS40LS45LS45LS45Wm0zLjUtNS43OGMtLjUgMC0uOS40LS45Ljl2MTcuNTVhLjkuOSAwIDAgMCAxLjgxIDBWNS43NmMwLS41LS40LS45LS45LS45Wm0zLjUxIDMuMzRjLS41IDAtLjkuNC0uOS45djEwLjg3YS45LjkgMCAwIDAgMS44IDBWOS4xYS45LjkgMCAwIDAtLjktLjkxWm0zLjUgMy4wOGMtLjUgMC0uOS40LS45LjkxdjQuN2EuOS45IDAgMSAwIDEuOCAwdi00LjdhLjkuOSAwIDAgMC0uOS0uOVptMy41MS03LjQ1YS45LjkgMCAwIDAtLjkxLjl2MTkuNmEuOS45IDAgMCAwIDEuODEgMFY0Ljc0YzAtLjUtLjQtLjktLjktLjlabTMuNSA1LjU3YS45LjkgMCAwIDAtLjkuOTF2OC40NWEuOS45IDAgMCAwIDEuOCAwdi04LjQ1YzAtLjUtLjQtLjktLjktLjlabTAgMFwiLz5cbiAgICAgICAgPGcgY2xpcC1wYXRoPVwidXJsKCNjKVwiPlxuICAgICAgICAgICAgPHBhdGggZD1cIk01NC4wNCAxMi45NmEuOS45IDAgMCAwLS45LjkxdjEuMzNhLjkuOSAwIDEgMCAxLjggMHYtMS4zMmEuOS45IDAgMCAwLS45LS45MlptMCAwXCIvPlxuICAgICAgICA8L2c+XG4gICAgPC9zdmc+XG4gICAgXG4gICAgICAgIGA7XG4gICAgICAgIHZhciBpY29uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsICdzdmcnKTtcbiAgICAgICAgYnV0dG9uLmFwcGVuZENoaWxkKGljb24pO1xuICAgICAgICBpY29uLm91dGVySFRNTCA9IGljb25IdG1sO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGFkZFN0eWxlcyhjc3MpIHtcbiAgICAgICAgY29uc3Qgc3R5bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzdHlsZScpO1xuICAgICAgICBzdHlsZS50eXBlID0gJ3RleHQvY3NzJztcbiAgICAgICAgc3R5bGUuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoY3NzKSk7XG4gICAgICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoc3R5bGUpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGFkZFRhbGtCdXR0b25TdHlsZXMoKSB7XG4gICAgICAgIHZhciBpc0ZpcmVmb3hBbmRyb2lkID0gL0ZpcmVmb3gvLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkgJiYgL0FuZHJvaWQvLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCk7XG4gICAgICAgIGlmIChpc0ZpcmVmb3hBbmRyb2lkKSB7XG4gICAgICAgICAgICAvLyBoYWNrIGZvciBGaXJlZm94IG9uIEFuZHJvaWQsIHdoaWNoIGRvZXNuJ3Qgc3VwcG9ydCA6YWN0aXZlIGNvcnJlY3RseVxuICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2ZpcmVmb3gtYW5kcm9pZCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gYnV0dG9uIGFuaW1hdGlvblxuICAgICAgICBhZGRTdHlsZXMoYFxuICAgICAgICAgICAgQGtleWZyYW1lcyBwdWxzZSB7XG4gICAgICAgICAgICAgICAgMCUge1xuICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm06IHNjYWxlKDEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICA1MCUge1xuICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm06IHNjYWxlKDAuOSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIDEwMCUge1xuICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm06IHNjYWxlKDEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICN0YWxrQnV0dG9uIHtcbiAgICAgICAgICAgICAgICBtYXJnaW4tdG9wOiAwLjI1cmVtO1xuICAgICAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDE4cHg7XG4gICAgICAgICAgICAgICAgd2lkdGg6IDEyMHB4O1xuICAgICAgICAgICAgICAgIGRpc3BsYXk6IGJsb2NrOyAvKiBGb3IgU2FmYXJpICovXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGh0bWw6bm90KC5maXJlZm94LWFuZHJvaWQpICN0YWxrQnV0dG9uOmFjdGl2ZSAud2F2ZWZvcm0sXG4gICAgICAgICAgICAjdGFsa0J1dHRvbi5hY3RpdmUgLndhdmVmb3JtIHtcbiAgICAgICAgICAgICAgICBhbmltYXRpb246IHB1bHNlIDFzIGluZmluaXRlO1xuICAgICAgICAgICAgfSAgICAgICAgICAgIFxuICAgICAgICAgICAgI3RhbGtCdXR0b24gLndhdmVmb3JtIHtcbiAgICAgICAgICAgICAgICBmaWxsOiAjNzc2ZDZkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgI3RhbGtCdXR0b24uYXV0b1N1Ym1pdCAud2F2ZWZvcm0ge1xuICAgICAgICAgICAgICAgIGZpbGw6IHJnYig2NSAxMzggNDcpOyAvKiBQaSdzIHRleHQtYnJhbmQtZ3JlZW4tNjAwICovXG4gICAgICAgICAgICB9XG4gICAgICAgIGApO1xuXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcmVnaXN0ZXJBdWRpb0J1dHRvbkV2ZW50cygpIHtcbiAgICAgICAgdmFyIGJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YWxrQnV0dG9uJyk7XG4gICAgICAgIHZhciBjb250ZXh0ID0gd2luZG93O1xuICAgICAgICBpZiAoR01faW5mby5zY3JpcHRIYW5kbGVyICE9PSAnVXNlcnNjcmlwdHMnKSB7XG4gICAgICAgICAgICBjb250ZXh0ID0gdW5zYWZlV2luZG93O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRm9yIGRlc2t0b3BcbiAgICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlkUHJvbXB0VGV4dEFyZWEoKTtcbiAgICAgICAgICAgIGNvbnRleHQuc3RhcnRSZWNvcmRpbmcoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBjb250ZXh0Py5zdG9wUmVjb3JkaW5nID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgY29udGV4dC5zdG9wUmVjb3JkaW5nKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJlZ2lzdGVySG90a2V5KCk7XG5cbiAgICAgICAgLy8gXCJ3YXJtIHVwXCIgdGhlIG1pY3JvcGhvbmUgYnkgYWNxdWlyaW5nIGl0IGJlZm9yZSB0aGUgdXNlciBwcmVzc2VzIHRoZSBidXR0b25cbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RhbGtCdXR0b24nKS5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWVudGVyJywgc2V0dXBSZWNvcmRpbmcpO1xuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFsa0J1dHRvbicpLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbGVhdmUnLCB0ZWFyRG93blJlY29yZGluZyk7XG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdiZWZvcmV1bmxvYWQnLCB0ZWFyRG93blJlY29yZGluZyk7XG5cbiAgICAgICAgLy8gQXR0YWNoIGEgZG91YmxlIGNsaWNrIGV2ZW50IGxpc3RlbmVyIHRvIHRoZSB0YWxrIGJ1dHRvblxuICAgICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignZGJsY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvLyBUb2dnbGUgdGhlIENTUyBjbGFzc2VzIHRvIGluZGljYXRlIHRoZSBtb2RlXG4gICAgICAgICAgICBidXR0b24uY2xhc3NMaXN0LnRvZ2dsZSgnYXV0b1N1Ym1pdCcpO1xuXG4gICAgICAgICAgICAvLyBTdG9yZSB0aGUgc3RhdGUgb24gdGhlIGJ1dHRvbiBlbGVtZW50IHVzaW5nIGEgY3VzdG9tIGRhdGEgYXR0cmlidXRlXG4gICAgICAgICAgICBpZiAoYnV0dG9uLmdldEF0dHJpYnV0ZSgnZGF0YS1hdXRvc3VibWl0JykgPT09ICd0cnVlJykge1xuICAgICAgICAgICAgICAgIGJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ2RhdGEtYXV0b3N1Ym1pdCcsICdmYWxzZScpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdhdXRvc3VibWl0IGRpc2FibGVkJyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ2RhdGEtYXV0b3N1Ym1pdCcsICd0cnVlJyk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2F1dG9zdWJtaXQgZW5hYmxlZCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBGb3IgbW9iaWxlXG4gICAgICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsgLy8gUHJldmVudCB0aGUgZGVmYXVsdCBjbGljayBiZWhhdmlvciBmcm9tIGhhcHBlbmluZ1xuICAgICAgICAgICAgaWRQcm9tcHRUZXh0QXJlYSgpO1xuICAgICAgICAgICAgY29udGV4dC5zdGFydFJlY29yZGluZygpO1xuICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsgLy8gQWRkIHRoZSBhY3RpdmUgY2xhc3MgKGZvciBGaXJlZm94IG9uIEFuZHJvaWQpXG4gICAgICAgIH0pO1xuICAgICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOyAvLyBSZW1vdmUgdGhlIGFjdGl2ZSBjbGFzcyAoZm9yIEZpcmVmb3ggb24gQW5kcm9pZFxuICAgICAgICAgICAgY29udGV4dC5zdG9wUmVjb3JkaW5nKCk7XG4gICAgICAgIH0pO1xuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFsa0J1dHRvbicpLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoY2FuY2VsJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsgLy8gUmVtb3ZlIHRoZSBhY3RpdmUgY2xhc3MgKGZvciBGaXJlZm94IG9uIEFuZHJvaWRcbiAgICAgICAgICAgIHRlYXJEb3duUmVjb3JkaW5nKCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuXG4gICAgZnVuY3Rpb24gcmVnaXN0ZXJIb3RrZXkoKSB7XG4gICAgICAgIC8vIFJlZ2lzdGVyIGEgaG90a2V5IGZvciB0aGUgYnV0dG9uXG4gICAgICAgIGxldCBjdHJsRG93biA9IGZhbHNlO1xuXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgIGlmIChldmVudC5jdHJsS2V5ICYmIGV2ZW50LmNvZGUgPT09ICdTcGFjZScgJiYgIWN0cmxEb3duKSB7XG4gICAgICAgICAgICAgICAgY3RybERvd24gPSB0cnVlO1xuICAgICAgICAgICAgICAgIC8vIFNpbXVsYXRlIG1vdXNlZG93biBldmVudFxuICAgICAgICAgICAgICAgIGxldCBtb3VzZURvd25FdmVudCA9IG5ldyBFdmVudCgnbW91c2Vkb3duJyk7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RhbGtCdXR0b24nKS5kaXNwYXRjaEV2ZW50KG1vdXNlRG93bkV2ZW50KTtcbiAgICAgICAgICAgICAgICB0YWxrQnV0dG9uLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOyAvLyBBZGQgdGhlIGFjdGl2ZSBjbGFzc1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgaWYgKGN0cmxEb3duICYmIGV2ZW50LmNvZGUgPT09ICdTcGFjZScpIHtcbiAgICAgICAgICAgICAgICBjdHJsRG93biA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIC8vIFNpbXVsYXRlIG1vdXNldXAgZXZlbnRcbiAgICAgICAgICAgICAgICBsZXQgbW91c2VVcEV2ZW50ID0gbmV3IEV2ZW50KCdtb3VzZXVwJyk7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RhbGtCdXR0b24nKS5kaXNwYXRjaEV2ZW50KG1vdXNlVXBFdmVudCk7XG4gICAgICAgICAgICAgICAgdGFsa0J1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG5cbiAgICBmdW5jdGlvbiBpZFByb21wdFRleHRBcmVhKCkge1xuICAgICAgICB2YXIgdGV4dGFyZWEgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvbXB0Jyk7XG4gICAgICAgIGlmICghdGV4dGFyZWEpIHtcbiAgICAgICAgICAgIC8vIEZpbmQgdGhlIGZpcnN0IDx0ZXh0YXJlYT4gZWxlbWVudCBhbmQgZ2l2ZSBpdCBhbiBpZFxuICAgICAgICAgICAgdmFyIHRleHRhcmVhRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ3RleHRhcmVhJyk7XG4gICAgICAgICAgICBpZiAodGV4dGFyZWFFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgdGV4dGFyZWFFbGVtZW50LmlkID0gJ3Byb21wdCc7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdObyA8dGV4dGFyZWE+IGVsZW1lbnQgZm91bmQnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIFN0YXJ0IG9ic2VydmluZyB0aGUgZW50aXJlIGRvY3VtZW50IGZvciBjaGFuZ2VzIHRvIGNoaWxkIG5vZGVzIGFuZCBzdWJ0cmVlXG4gICAgb2JzZXJ2ZXIub2JzZXJ2ZShkb2N1bWVudCwgeyBjaGlsZExpc3Q6IHRydWUsIHN1YnRyZWU6IHRydWUgfSk7XG59KSgpO1xuIl0sIm5hbWVzIjpbImxvY2FsQ29uZmlnIiwiYXBwU2VydmVyVXJsIiwiYXBpU2VydmVyVXJsIiwicHJvZHVjdGlvbkNvbmZpZyIsImNvbmZpZyIsInBhZ2VTY3JpcHQiLCJyZXF1aXJlIiwib2JzZXJ2ZXIiLCJNdXRhdGlvbk9ic2VydmVyIiwibXV0YXRpb25zIiwiaSIsImxlbmd0aCIsIm11dGF0aW9uIiwiYWRkZWROb2RlcyIsImoiLCJub2RlIiwibm9kZU5hbWUiLCJ0b0xvd2VyQ2FzZSIsImNsYXNzTGlzdCIsImNvbnRhaW5zIiwiZm9vdGVyIiwiYnV0dG9uQ29udGFpbmVyIiwicXVlcnlTZWxlY3RvciIsImFkZFRhbGtCdXR0b24iLCJjb25zb2xlIiwibG9nIiwiZGlzY29ubmVjdCIsImluamVjdFNjcmlwdCIsImNhbGxiYWNrIiwic2NyaXB0RWxlbWVudCIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsInR5cGUiLCJpZCIsImNvbmZpZ1RleHQiLCJKU09OIiwic3RyaW5naWZ5IiwidGV4dENvbnRlbnQiLCJib2R5IiwiYXBwZW5kQ2hpbGQiLCJjb250YWluZXIiLCJidXR0b24iLCJjbGFzc05hbWUiLCJsYWJlbCIsInNldEF0dHJpYnV0ZSIsImRhdGFzZXQiLCJhdXRvc3VibWl0IiwiYWRkIiwiYWRkVGFsa0J1dHRvblN0eWxlcyIsImFkZFRhbGtJY29uIiwicmVnaXN0ZXJBdWRpb0J1dHRvbkV2ZW50cyIsImljb25IdG1sIiwiaWNvbiIsImNyZWF0ZUVsZW1lbnROUyIsIm91dGVySFRNTCIsImFkZFN0eWxlcyIsImNzcyIsInN0eWxlIiwiY3JlYXRlVGV4dE5vZGUiLCJoZWFkIiwiaXNGaXJlZm94QW5kcm9pZCIsInRlc3QiLCJuYXZpZ2F0b3IiLCJ1c2VyQWdlbnQiLCJkb2N1bWVudEVsZW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImNvbnRleHQiLCJ3aW5kb3ciLCJHTV9pbmZvIiwic2NyaXB0SGFuZGxlciIsInVuc2FmZVdpbmRvdyIsImFkZEV2ZW50TGlzdGVuZXIiLCJpZFByb21wdFRleHRBcmVhIiwic3RhcnRSZWNvcmRpbmciLCJfY29udGV4dCIsInN0b3BSZWNvcmRpbmciLCJyZWdpc3RlckhvdGtleSIsInNldHVwUmVjb3JkaW5nIiwidGVhckRvd25SZWNvcmRpbmciLCJ0b2dnbGUiLCJnZXRBdHRyaWJ1dGUiLCJlIiwicHJldmVudERlZmF1bHQiLCJyZW1vdmUiLCJjdHJsRG93biIsImV2ZW50IiwiY3RybEtleSIsImNvZGUiLCJtb3VzZURvd25FdmVudCIsIkV2ZW50IiwiZGlzcGF0Y2hFdmVudCIsInRhbGtCdXR0b24iLCJtb3VzZVVwRXZlbnQiLCJ0ZXh0YXJlYSIsInRleHRhcmVhRWxlbWVudCIsIm9ic2VydmUiLCJjaGlsZExpc3QiLCJzdWJ0cmVlIl0sInNvdXJjZVJvb3QiOiIifQ==